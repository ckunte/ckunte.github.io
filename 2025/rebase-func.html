<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chetan Kunté: shell functions for rebase</title>
<meta name="description" content="Often I find the need to <a..." />
<script src="/inc/code-math.js" integrity="sha384-xT8wN8NCeuamUQtBjQWvwc7dCGAT89VKkZR5MVAcr18p99euBN7VZVb0NH07+lYA"></script>
<link rel="icon" href="data:," />
<link type="text/css" rel="stylesheet" href="/inc/home.css" />
</head>
<body>
<main>
<header>
    <a accesskey="/" title="Home" href="/"><img alt="Chetan Kunté" class="logo" src="/inc/favicon.svg" width="26" height="21.37"></a>
</header>	
<article>
<h1>shell functions for rebase</h1>
<time datetime="2025-10-05T15:46:00+08:00">
5 Oct 2025, 
3 min</time>
<p>Often I find the need to <a href="https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History">squash commits</a>, especially those that don&rsquo;t need to stand-alone. And so little a function, which is more an alias with arguments, is used for the job, so I don&rsquo;t have to think. The <a href="https://git-scm.com" title="git -- a free and open source distributed version control system">git</a> command I use for this in, say, <code>master</code> branch, looks like this:</p>
<pre><code class="language-sh">git rebase -i origin/master~4 master
</code></pre>
<p>The <code>-i</code> switch makes it interactive, and in the (below) list it produces, I can mark lines selectively from <code>pick</code> to <code>squash</code> for items to be squashed, followed by <code>:wq</code>.<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup> If there are multiples marked up in the list, then git produces parent commits with an option to edit commit message(s) should you want to, and you can follow it up with <code>:wq</code>. Here&rsquo;s an example of the list, in which, one can markup the first column as required.</p>
<pre><code>pick fa77b22 # m:homepage updates
pick 04863ce # link titles update
squash c8fb9a8 # m:edit

# Rebase 69a0567..c8fb9a8 onto 69a0567 (3 commands)
#
# Commands:
# p, pick &lt;commit&gt; = use commit
# r, reword &lt;commit&gt; = use commit, but edit the commit message
# e, edit &lt;commit&gt; = use commit, but stop for amending
# s, squash &lt;commit&gt; = use commit, but meld into previous commit
...
</code></pre>
<p>I follow it up with a forced <a href="https://git-scm.com/docs/git-push" title="Update remote refs along with associated objects">push</a> like so &mdash; for sending it upstream. It&rsquo;s <em>only</em> if the remote already <em>has</em> commits you&rsquo;re trying to squash.</p>
<pre><code class="language-sh">git push -u origin +master
</code></pre>
<h2 id="fish-shell">fish shell</h2>
<p>The <a href="https://git-scm.com/docs/git-rebase" title="Reapply commits on top of another base tip">rebase</a> command feels a little tedious to type out at the prompt, and so this function (placed in <code>~/.config/fish/config.fish</code>) helps me do the job quickly by running the command <code>gr 4 master</code>, which translates to the first command above:</p>
<pre><code class="language-sh"># fish function to rebase, e.g., gr 4 master
function gr
  git rebase -i origin/$argv[2]~argv[1] $argv[2]
end
</code></pre>
<p>Using two arguments for the freedom to define the number of commits, and the other being able to choose the branch. </p>
<p>For the push, I could write a function to run <code>gpp master</code> like so:</p>
<pre><code class="language-sh"># fish function for push following rebase, e.g., gpp master
function gpp
  git push -u origin +$argv[1]
end
</code></pre>
<h2 id="bash-shell">bash shell</h2>
<p>Of course, I have machines where bash is still the default. For those, the function (placed in, e.g., <code>~/.bashrc</code>) becomes:</p>
<pre><code class="language-sh"># bash function for rebase, e.g., gr 4 master
gr() {
  git rebase -i origin/&quot;${2}~${1}&quot; &quot;$2&quot;
}
</code></pre>
<p>And for the push in bash, the function would be:</p>
<pre><code class="language-sh"># bash function for the push post rebase, e.g., gpp master
gpp() {
  git push -u origin +&quot;$1&quot;
}
</code></pre>
<hr />
<p>Pulling from a force-pushed remote repository, say, <code>origin/master</code> needs some care. The right way is as follows:</p>
<pre><code class="language-sh">git fetch origin
git reset --hard origin/master
</code></pre>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Write and quit in Vim, which is my default git commit editor.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
</article>
<footer>
  <span>&lsaquo; <a accesskey="j" title="Keyboard" href="/2025/keyboard">Prev</a></span>
  <span><a accesskey="k" title="Fish functions" href="/2025/fish-func">Next</a> &rsaquo;</span>
</footer>
</main>
</body>
</html>